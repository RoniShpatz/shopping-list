{% extends "base.html" %}
{% block title %}Home{% endblock %}
{%block main%}

<h1>Hello {{ name|capitalize }}, what would you like to do? </h1>
<div>
    <div>{%for name in shopping_list%}
        <p> {{name}}</p>
        {% endfor %}
    </div>
    <div>
        {% for list_name, items  in shopping_list.items() %}
        <div>
            <h2 class="list_name">{{list_name}}</h2>
            {% set categories = items | map(attribute='category') | unique %}

           
            {% for category in categories %}
            <div>
                <h4>{{ category }}</h4> 
                <ul>
           
                    {% for item in items if item.category == category %}
                        <li>
                            {{ item.quantity }} {{ item.name }}
                            {% if item.notes %}
                                ({{ item.notes }})
                            {% endif %}
                        </li>
                    {% endfor %}
                </ul>
            {% endfor %}
            </div>
        </div>
    
        <form action="/home_edit" method="POST" >
            <input name="shopping_list_name"  class="shopping_list_name_hidden" value="">
            <input  name="quantity" placeholder="000" type="number" maxlength="4">
            <label for="products"></label>
            <input name="product" placeholder="Add product" list="products" class="product-input">
            <datalist id="products">
                {% for id, product, category in products_list %}
                <option value="{{product}}">{{product}} </option>
                <span id="category">{{category}}</span>
                {% endfor %}
                </datalist>
                <label for="categories"></label>
                
                <input name="category" placeholder="Add category" list="categories" class="category_input">
                <datalist id="categories">
                    {% set seen_categories = [] %} 
                    {% for id, product, category in products_list %}
                    {% if category not in seen_categories %}
                        <option value="{{ category }}">{{ category }}</option>
                        {{ seen_categories.append(category)}}
                    {%  endif %}
                    {% endfor %}
                    </datalist>
            <input name="notes" placeholder="Add notes">
            <button type="submit">✔</button>
            <button type="reset">✖</button>
        </form>

    </div>
    <a href="{{active_shopping}}">Start Shopping</a>
    <!-- <a href="{{add_products}}">Add products</a> -->
    <div>
        {% endfor %}
    </div>
    <div>

 
    </div>


</div>



<script type="text/javascript"> 
  
 var products_list = {{products_list | tojson}} ;         
var products_list_obj = []
products_list.forEach(arry => {
    products_list_obj.push(
        {
            id: arry[0],
            name: arry[1],
            category: arry[2]
        }
    )
})
productInput = document.querySelectorAll(".product-input")
categoryInput = document.querySelectorAll(".category_input")

productInput.forEach((input, index) => {
    input.addEventListener("change", () => {
        var newValue = input.value
        var product = products_list_obj.find( p => p.name === newValue)
        categoryInput[index].value = product.category
    })
})

</script>
<script src="../static/js/home.js"></script>
{%endblock%}